<!DOCTYPE html>
<html>
  <head>
    <title>great</title>
    <link rel="icon"href="icon.png.png">
  </head>
  <body><!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>迷跡旅館 Labyrinth Hotel</title>
<style>
html,body{
  margin:0;height:100%;
  background:#000;
  overflow:hidden;
  font-family:Arial,sans-serif;
}
canvas{display:block}
.overlay{
  position:fixed;inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.65);
  z-index:10;color:#fff;
}
.menu{
  background:#181818;
  padding:20px;
  border-radius:10px;
  text-align:center;
}
button{
  padding:8px 14px;
  margin:6px;
  border:none;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
}
.easy{background:#2ecc71}
.normal{background:#f1c40f}
.hard{background:#e67e22}
.hell{background:#e74c3c;color:#fff}
#hud{
  position:fixed;
  top:10px;left:10px;
  color:#fff;
  z-index:5;
  font-weight:bold;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="menu" class="overlay">
  <div class="menu">
    <h2>迷跡旅館</h2>
    <p>方向鍵 / WASD 移動<br>空白鍵射擊　F 手電筒</p>
    <button class="easy" onclick="startGame('EASY')">EASY</button>
    <button class="normal" onclick="startGame('NORMAL')">NORMAL</button>
    <button class="hard" onclick="startGame('HARD')">HARD</button>
    <button class="hell" onclick="startGame('HELL')">HELL</button>
  </div>
</div>

<div id="hud" style="display:none"></div>

<script>
/* ===== Canvas ===== */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener('resize',resize);
resize();

/* ===== Config ===== */
const TILE = 28;
const COLS = 40;
const ROWS = 40;

const DIFF = {
  EASY:{ammo:3,ghost:30},
  NORMAL:{ammo:5,ghost:18},
  HARD:{ammo:8,ghost:12},
  HELL:{ammo:8,ghost:8}
};

/* ===== State ===== */
let maze=[];
let player={x:1,y:1};
let ghosts=[];
let started=false;
let gameOver=false;
let flashlight=true;
let difficulty='NORMAL';
let level=1;
let ammo=0;
let lastAmmo=0;

/* ===== Input ===== */
const keys={};
addEventListener('keydown',e=>{
  keys[e.key]=true;
  if(e.key==='f'||e.key==='F') flashlight=!flashlight;
  if(e.key===' ') shoot();
});
addEventListener('keyup',e=>keys[e.key]=false);

/* ===== Maze ===== */
function generateMaze(w,h){
  const g=Array.from({length:h},()=>Array(w).fill('W'));
  function carve(x,y){
    g[y][x]='.';
    const d=[[2,0],[-2,0],[0,2],[0,-2]].sort(()=>Math.random()-0.5);
    for(const [dx,dy] of d){
      const nx=x+dx,ny=y+dy;
      if(nx>0&&ny>0&&nx<w-1&&ny<h-1&&g[ny][nx]==='W'){
        g[y+dy/2][x+dx/2]='.';
        carve(nx,ny);
      }
    }
  }
  carve(1,1);
  g[h-2][w-2]='.';
  return g;
}

function isWalkable(x,y){
  return x>=0&&y>=0&&x<COLS&&y<ROWS&&maze[y][x]!== 'W';
}

/* ===== Spawn ===== */
function spawn(){
  maze=generateMaze(COLS,ROWS);
  player={x:1,y:1};
  ghosts=[];
  const base=difficulty==='EASY'?2:difficulty==='NORMAL'?3:difficulty==='HARD'?4:5;
  for(let i=0;i<base+level-1;i++){
    let x,y;
    do{
      x=Math.floor(Math.random()*COLS);
      y=Math.floor(Math.random()*ROWS);
    }while(!isWalkable(x,y)||Math.abs(x-player.x)+Math.abs(y-player.y)<8);
    ghosts.push({x,y});
  }
  ammo=DIFF[difficulty].ammo;
  lastAmmo=performance.now();
}

/* ===== Shoot ===== */
function shoot(){
  if(ammo<=0) return;
  ammo--;
  for(const g of ghosts){
    const d=Math.abs(g.x-player.x)+Math.abs(g.y-player.y);
    if(d<=2){
      g.x+=Math.sign(g.x-player.x);
      g.y+=Math.sign(g.y-player.y);
    }
  }
}

/* ===== Logic ===== */
let lastMove=0;
let lastGhost=0;

function update(){
  const now=performance.now();

  if(now-lastMove>120){
    if(keys.ArrowUp||keys.w) move(0,-1);
    else if(keys.ArrowDown||keys.s) move(0,1);
    else if(keys.ArrowLeft||keys.a) move(-1,0);
    else if(keys.ArrowRight||keys.d) move(1,0);
  }

  if(now-lastGhost>DIFF[difficulty].ghost*16){
    lastGhost=now;
    ghosts.forEach(g=>{
      const dx=Math.sign(player.x-g.x);
      const dy=Math.sign(player.y-g.y);
      if(isWalkable(g.x+dx,g.y)) g.x+=dx;
      else if(isWalkable(g.x,g.y+dy)) g.y+=dy;
    });
  }

  if(now-lastAmmo>4000){
    lastAmmo=now;
    ammo=Math.min(ammo+1,DIFF[difficulty].ammo);
  }

  for(const g of ghosts){
    if(g.x===player.x&&g.y===player.y){
      alert('你被抓到了！');
      location.reload();
    }
  }

  if(player.x===COLS-2&&player.y===ROWS-2){
    alert('過關！');
    level++;
    spawn();
  }
}

function move(dx,dy){
  const nx=player.x+dx,ny=player.y+dy;
  if(isWalkable(nx,ny)){
    player.x=nx;player.y=ny;
    lastMove=performance.now();
  }
}

/* ===== Draw ===== */
function draw(){
  ctx.fillStyle='#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const camX=player.x*TILE-canvas.width/2;
  const camY=player.y*TILE-canvas.height/2;

  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      ctx.fillStyle=maze[y][x]==='W'?'#444':'#222';
      ctx.fillRect(x*TILE-camX,y*TILE-camY,TILE,TILE);
    }
  }

  ctx.fillStyle='#0ff';
  ctx.fillRect(player.x*TILE-camX,player.y*TILE-camY,TILE,TILE);

  ctx.fillStyle='#e33';
  ghosts.forEach(g=>{
    ctx.beginPath();
    ctx.arc(g.x*TILE-camX+TILE/2,g.y*TILE-camY+TILE/2,12,0,Math.PI*2);
    ctx.fill();
  });

  if(flashlight){
    ctx.fillStyle='rgba(0,0,0,.5)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  document.getElementById('hud').innerHTML=
    `Level ${level}<br>Ammo ${ammo}`;
}

/* ===== Loop ===== */
function loop(){
  if(started){
    update();
    draw();
  }
  requestAnimationFrame(loop);
}
loop();

/* ===== Start ===== */
function startGame(d){
  difficulty=d;
  document.getElementById('menu').style.display='none';
  document.getElementById('hud').style.display='block';
  started=true;
  spawn();
}
</script>
</body>
</html>


</html>






</script>


